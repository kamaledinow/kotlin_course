# Highway Avg Guard

Мобильное веб-приложение (PWA) для Android-браузера, которое помогает контролировать **среднюю скорость** на трассе и снижает риск штрафа.

## Что умеет
- считает текущую и среднюю скорость по GPS;
- каждые 5 минут озвучивает подсказку голосом (Web Speech API);
- показывает, сколько минут можно сохранять текущую скорость, пока средняя остаётся в «безопасной» зоне;
- если средняя слишком высокая, подсказывает, до какой скорости снизиться (например, 80 км/ч) и сколько минут так ехать, чтобы вернуться к целевому среднему значению (например, 118–119 км/ч).

## Запуск
```bash
python3 -m http.server 8080
```
Откройте в браузере: `http://localhost:8080`.

## Использование
1. Нажмите **«Старт»**.
2. Разрешите геолокацию.
3. Установите параметры:
   - **Порог штрафа (средняя)**, обычно 120 км/ч;
   - **Цель с запасом**, например 119 км/ч;
   - **Скорость восстановления**, например 80 км/ч.
4. Следуйте подсказкам на экране и голосовым уведомлениям каждые 5 минут.


## Откуда берётся скорость
- Источник №1: `navigator.geolocation.watchPosition(...)` (GPS/AGPS от браузера Android).
- Если браузер отдаёт `coords.speed`, берём её как текущую скорость (м/с -> км/ч).
- Если `coords.speed` недоступна, считаем скорость по двум точкам: расстояние (haversine) / время между GPS-обновлениями.
- Для устойчивости отфильтровываем шум: игнорируем точки с точностью хуже 50 м, сглаживаем скорость средним по последним 5 замерам и отбрасываем нереалистичные пики выше 220 км/ч.


## Можно ли запускать прямо из GitHub
Да, через **GitHub Pages** (это самый удобный вариант):
1. Залейте репозиторий на GitHub.
2. В `Settings -> Pages` включите публикацию ветки (обычно `main`/`master`, folder `/root`).
3. Получите ссылку вида `https://<user>.github.io/<repo>/` и откройте её на Android.

Важно:
- Геолокация работает только в **HTTPS** или на `localhost`. GitHub Pages использует HTTPS, поэтому подходит.
- Нужно дать разрешение на геолокацию в браузере.
- На ПК без GPS точность/скорость могут быть хуже, чем на телефоне.

## APK для установки на Android
Да, можно получать именно `.apk`:

### Вариант 1 (рекомендуется): сборка через GitHub Actions
1. Запушьте репозиторий на GitHub.
2. Откройте `Actions` -> `Build Android APK` -> `Run workflow`.
3. После завершения скачайте артефакт `highway-avg-guard-debug-apk`.
4. Файл внутри: `app-debug.apk` — его можно установить на Android.

### Вариант 2 (локально)
```bash
npm ci
npm run build:apk
```
APK появится в: `android/app/build/outputs/apk/debug/app-debug.apk`.

> Для Android 8+ может понадобиться включить установку из неизвестных источников для браузера/файлового менеджера, из которого запускаете APK.


## Апдейт по PR (чтобы довести до финала)
Сделано в этом апдейте:
- добавлена поддержка геолокации через **Capacitor Geolocation** внутри Android-приложения (не только browser `navigator.geolocation`);
- добавлены Android permissions: `ACCESS_COARSE_LOCATION`, `ACCESS_FINE_LOCATION`;
- web fallback оставлен, поэтому приложение работает и как обычная PWA в браузере.

Что сделать для финального результата:
1. Запустить GitHub Actions workflow `Build Android APK`.
2. Скачать артефакт `highway-avg-guard-debug-apk` и установить `app-debug.apk` на устройство.
3. При первом запуске дать разрешение на геолокацию.

## Ограничения
- Точность зависит от качества GPS и частоты обновления координат.
- Расчёты являются ориентировочными и не заменяют дорожные знаки и ПДД.
